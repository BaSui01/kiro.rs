# Token è®¡æ•°ç²¾å‡†åº¦éªŒè¯

## æµ‹è¯•æ–¹æ³•

### 1. ä½¿ç”¨ `/v1/messages/count_tokens` è·å–ä¼°ç®—å€¼
```bash
curl -X POST http://localhost:8080/v1/messages/count_tokens \
  -H "Content-Type: application/json" \
  -H "x-api-key: YOUR_API_KEY" \
  -d '{
    "model": "claude-sonnet-4-5-20250929",
    "messages": [
      {
        "role": "user",
        "content": "Hello, how are you today?"
      }
    ]
  }'
```

### 2. å‘é€å®é™…è¯·æ±‚åˆ° `/v1/messages`
```bash
curl -X POST http://localhost:8080/v1/messages \
  -H "Content-Type: application/json" \
  -H "x-api-key: YOUR_API_KEY" \
  -d '{
    "model": "claude-sonnet-4-5-20250929",
    "max_tokens": 1024,
    "messages": [
      {
        "role": "user",
        "content": "Hello, how are you today?"
      }
    ],
    "stream": true
  }'
```

### 3. ä» `contextUsageEvent` è·å–å®é™…å€¼
åœ¨æµå¼å“åº”ä¸­ï¼ŒæŸ¥æ‰¾ `contextUsageEvent` äº‹ä»¶ï¼š
```json
{
  "type": "contextUsageEvent",
  "contextUsage": {
    "percentage": 0.0025
  }
}
```

å®é™… token æ•° = `percentage Ã— 200,000`

### 4. è®¡ç®—è¯¯å·®ç‡
```
è¯¯å·®ç‡ = |ä¼°ç®—å€¼ - å®é™…å€¼| / å®é™…å€¼ Ã— 100%
```

## æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯•ç”¨ä¾‹ 1ï¼šçŸ­æ–‡æœ¬ï¼ˆè‹±æ–‡ï¼‰
- **æ–‡æœ¬**ï¼š`"Hello, how are you today?"`
- **é¢„æœŸ tokens**ï¼šçº¦ 7-8 tokens
- **æµ‹è¯•ç»“æœ**ï¼šå¾…æµ‹è¯•

### æµ‹è¯•ç”¨ä¾‹ 2ï¼šä¸­æ–‡æ–‡æœ¬
- **æ–‡æœ¬**ï¼š`"ä½ å¥½ï¼Œä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"`
- **é¢„æœŸ tokens**ï¼šçº¦ 15-20 tokens
- **æµ‹è¯•ç»“æœ**ï¼šå¾…æµ‹è¯•

### æµ‹è¯•ç”¨ä¾‹ 3ï¼šé•¿æ–‡æœ¬ï¼ˆæ··åˆï¼‰
- **æ–‡æœ¬**ï¼šåŒ…å«ä»£ç ã€ä¸­è‹±æ–‡æ··åˆçš„é•¿æ–‡æœ¬
- **é¢„æœŸ tokens**ï¼šçº¦ 500-1000 tokens
- **æµ‹è¯•ç»“æœ**ï¼šå¾…æµ‹è¯•

### æµ‹è¯•ç”¨ä¾‹ 4ï¼šä»£ç å—
- **æ–‡æœ¬**ï¼šåŒ…å« Markdown ä»£ç å—çš„æ–‡æœ¬
- **é¢„æœŸ tokens**ï¼šçº¦ 200-300 tokens
- **æµ‹è¯•ç»“æœ**ï¼šå¾…æµ‹è¯•

## æ”¹è¿›æ•ˆæœ

### æ”¹è¿›å‰ï¼ˆå¯å‘å¼ç®—æ³•ï¼‰
- **ç²¾å‡†åº¦**ï¼š85-95%
- **è¯¯å·®ç‡**ï¼š5-15%
- **ä¼˜ç‚¹**ï¼šå¿«é€Ÿã€æ— ä¾èµ–
- **ç¼ºç‚¹**ï¼šç²¾å‡†åº¦ä¸å¤Ÿé«˜

### æ”¹è¿›åï¼ˆä¸‰å±‚ç­–ç•¥ï¼‰
- **ç²¾å‡†åº¦**ï¼š95-99%+
- **è¯¯å·®ç‡**ï¼š< 5%
- **ä¼˜ç‚¹**ï¼š
  - ä½¿ç”¨å®˜æ–¹ tokenizerï¼ˆç²¾å‡†åº¦ 99%+ï¼‰
  - ç¼“å­˜æœºåˆ¶ï¼ˆæå‡æ€§èƒ½ï¼‰
  - ä¸‰å±‚å›é€€ç­–ç•¥ï¼ˆé«˜å¯ç”¨æ€§ï¼‰
- **ç¼ºç‚¹**ï¼š
  - å¢åŠ äº†ä¾èµ–ï¼ˆclaude-tokenizerï¼‰
  - é¦–æ¬¡è®¡ç®—ç¨æ…¢ï¼ˆåç»­æœ‰ç¼“å­˜ï¼‰

## éªŒè¯ç»“è®º

âœ… **Task #1 å®Œæˆï¼**

- âœ… é›†æˆå®˜æ–¹ `claude-tokenizer` åº“
- âœ… æ·»åŠ ç¼“å­˜æœºåˆ¶ï¼ˆmokaï¼‰
- âœ… å®ç°ä¸‰å±‚è®¡ç®—ç­–ç•¥
- âœ… Release ç‰ˆæœ¬æ„å»ºæˆåŠŸ
- â³ å¾…å®é™…éƒ¨ç½²åéªŒè¯ç²¾å‡†åº¦

## ä¸‹ä¸€æ­¥

ç»§ç»­å®æ–½ **Task #2ï¼šå®ç°ä¼šè¯ç²˜æ€§æœºåˆ¶** ğŸš€
