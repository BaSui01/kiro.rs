version: '3.8'

services:
  kiro-rs:
    build: .
    container_name: kiro-rs
    restart: unless-stopped
    ports:
      - "8990:8990"
    volumes:
      # 挂载整个配置目录，程序会在此目录读写以下文件：
      # - config.json: 主配置文件（必需）
      # - credentials.json: 凭据文件（必需，会被程序自动更新 token）
      # - pools.json: 池配置文件（可选，通过 Admin UI 管理时会自动创建）
      # - api_keys.json: API Key 配置文件（可选，通过 Admin UI 管理时会自动创建）
      - ./config:/app/config
    environment:
      - RUST_LOG=info
    # 健康检查
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8990/v1/models"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

# 使用说明：
# 1. 创建配置目录: mkdir -p config
# 2. 准备必需的配置文件:
#    - config/config.json (从 config.example.json 复制并修改)
#    - config/credentials.json (填入你的凭据)
# 3. 可选配置文件（也可以通过 Admin UI 创建）:
#    - config/pools.json (池配置)
#    - config/api_keys.json (多 API Key 配置)
# 4. 启动: docker-compose up -d
# 5. 访问 Admin UI: http://localhost:8990/admin
